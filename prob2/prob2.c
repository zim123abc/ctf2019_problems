#include <stdio.h>
#include <stdlib.h>
#include <string.h>

//key=20E8B88116BDE340D86697561087761639BFD48B3132CF593F6069F7669771F1
//iv =82E9F9012990492EF21F98321A81B295

char * xorencrypt(unsigned char * message, char * key) {
  size_t messagelen = 96;
  size_t keylen = strlen(key);

  char * encrypted = malloc(messagelen+1);

  int i;
  for(i = 0; i < messagelen; i++) {
    encrypted[i] = message[i] ^ key[i % keylen];
  }
  encrypted[messagelen] = '\0';

  return encrypted;
}

int main(int argc, char *argv[], char *envp[]) {
  char * message = "test message";
  char * key = "ctf2019";
  int test1 = 4452;
  char * test3 = "flag";
  unsigned char text[] = {0x51, 0x44, 0x23, 0x0a, 0x72, 0x09, 0x01, 0x52, 0x45, 0x50, 0x70, 0x74, 0x74, 0x0a, 0x57, 0x44, 0x22, 0x0a, 0x06, 0x07, 0x00, 0x54, 0x41, 0x50, 0x03, 0x00, 0x09, 0x0e, 0x54, 0x42, 0x57, 0x04, 0x03, 0x08, 0x7b, 0x25, 0x30, 0x52, 0x0a, 0x72, 0x02, 0x08, 0x50, 0x46, 0x25, 0x74, 0x05, 0x08, 0x0a, 0x25, 0x42, 0x56, 0x04, 0x09, 0x77, 0x0e, 0x55, 0x42, 0x5f, 0x05, 0x07, 0x00, 0x7f, 0x52, 0x4c, 0x54, 0x77, 0x09, 0x77, 0x00, 0x53, 0x45, 0x54, 0x0b, 0x09, 0x01, 0x0d, 0x5a, 0x46, 0x23, 0x74, 0x02, 0x00, 0x7f, 0x5a, 0x4c, 0x55, 0x00, 0x01, 0x70, 0x01, 0x52, 0x36, 0x54, 0x0b, 0x05};
  char buf[256];
  int test2 = 99867;
  if(argc < 2) {
    printf("Usage: %s <text to print>\n", argv[0]);
    exit(0);
  }
  strcpy(buf, argv[1]);
  printf(buf);
  printf("\n");
  char * encrypted = xorencrypt(text, key);
  // Debug output
  //printf("[*] test_val @ 0x%08x = %d 0x%08x\n", &test_val, test_val, test_val);
  exit(0);
}
